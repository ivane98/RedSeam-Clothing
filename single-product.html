<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>RedSeam Clothing - Kids' Curved Hilfiger Graphic T-Shirt</title>
    <link rel="stylesheet" href="styles/globals.css" />
    <link rel="stylesheet" href="styles/styleguide.css" />
    <link rel="stylesheet" href="/styles/single-product/style.css" />
  </head>

  <body>
    <main class="listing-page">
      <header class="header">
        <div class="div">
          <img
            class="img"
            src="images/HandEye.png"
            alt="RedSeam Clothing Logo"
          />
          <h1 class="text-wrapper">RedSeam Clothing</h1>
        </div>
        <nav class="frame" role="navigation" aria-label="User navigation">
          <button class="cart-button" type="button" aria-label="Shopping cart">
            <img class="img" src="images/shopping-cart.png" alt="" />
          </button>
          <div class="div">
            <img
              class="ellipse"
              src="images/profile-picture-big.png"
              alt="User profile"
            />
            <button
              class="profile-dropdown"
              type="button"
              aria-label="User menu"
            >
              <img
                class="heroicons-mini"
                src="images/chevron-down.png"
                alt=""
              />
            </button>
          </div>
        </nav>
      </header>

      <nav class="text-wrapper-2" aria-label="Breadcrumb">
        Listing / Product
      </nav>

      <aside class="frame-2" aria-label="Product thumbnails"></aside>
      <section class="product-image" aria-label="Main product image">
        <img
          class="rectangle"
          src="images/rectangle-1.png"
          alt="Kids' Curved Hilfiger Graphic T-Shirt - Main product image"
        />
      </section>
      <section class="frame-3" aria-label="Product details">
        <header class="frame-4">
          <h2 class="product-name"></h2>
          <div class="product-price" aria-label="Price"></div>
        </header>
        <form class="frame-5" aria-label="Product options">
          <fieldset class="frame-6">
            <legend class="text-wrapper-4">Color: Baby pink</legend>
            <div class="frame-7" role="radiogroup" aria-label="Color options">
              <input
                type="radio"
                id="color-purple"
                name="color"
                value="purple"
                class="color-input"
              />
              <label
                for="color-purple"
                class="component"
                aria-label="Purple color option"
              ></label>
              <input
                type="radio"
                id="color-pink"
                name="color"
                value="pink"
                checked
                class="color-input"
              />
              <label
                for="color-pink"
                class="ellipse-wrapper"
                aria-label="Baby pink color option"
              >
                <div class="ellipse-2"></div>
              </label>
              <input
                type="radio"
                id="color-yellow"
                name="color"
                value="yellow"
                class="color-input"
              />
              <label
                for="color-yellow"
                class="component-2"
                aria-label="Yellow color option"
              ></label>
            </div>
          </fieldset>
          <fieldset class="frame-8">
            <legend class="text-wrapper-4">Size: L</legend>
            <div class="frame-9" role="radiogroup" aria-label="Size options">
              <input
                type="radio"
                id="size-xs"
                name="size"
                value="xs"
                class="size-input"
              />
              <label for="size-xs" class="size">
                <span class="l">XS</span>
              </label>
              <input
                type="radio"
                id="size-s"
                name="size"
                value="s"
                class="size-input"
              />
              <label for="size-s" class="size">
                <span class="l">S</span>
              </label>
              <input
                type="radio"
                id="size-m"
                name="size"
                value="m"
                class="size-input"
              />
              <label for="size-m" class="size">
                <span class="l">M</span>
              </label>
              <input
                type="radio"
                id="size-l"
                name="size"
                value="l"
                checked
                class="size-input"
              />
              <label for="size-l" class="div-wrapper">
                <span class="text-wrapper-5">L</span>
              </label>
              <input
                type="radio"
                id="size-xl"
                name="size"
                value="xl"
                class="size-input"
              />
              <label for="size-xl" class="size">
                <span class="l">XL</span>
              </label>
            </div>
          </fieldset>
          <div class="frame-10">
            <label for="quantity" class="text-wrapper-4">Quantity</label>
            <div class="size-2">
              <select
                id="quantity"
                name="quantity"
                class="quantity-select"
                aria-label="Select quantity"
              >
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
              <span class="l-2">3</span>
              <img
                class="heroicons-mini-3"
                src="images/chevron-down.png"
                alt=""
              />
            </div>
          </div>
        </form>
        <button class="primary" type="submit" form="product-form">
          <img class="img" src="images/cart-outline.png" alt="" />
          <span class="text-wrapper-6">Add to cart</span>
        </button>
        <hr class="line" />
        <section class="frame-11" aria-label="Product details">
          <header class="frame-12">
            <h3 class="text-wrapper-7">Details</h3>
            <img
              class="image-2"
              src="images/image-6.png"
              alt="Tommy Hilfiger brand logo"
            />
          </header>
          <div class="frame-13">
            <p class="text-wrapper-8">Brand: Tommy Hilfiger</p>
            <p class="p">
              This product contains regenerative cotton, which is grown using
              farming methods that seek to improve soil health, watersheds and
              biodiversity.
            </p>
          </div>
        </section>
      </section>
      <!--  -->
      <div class="rectangle-2" aria-hidden="true"></div>

      <aside class="shopping-cart" aria-label="Shopping cart">
        <img class="heroicons-solid-x" src="/images/x-mark.png" alt="" />
        <h2 class="text-wrapper-9">Shopping cart (2)</h2>
        <article class="frame-14" aria-label="Cart item 1">
          <img
            class="rectangle-3"
            src="images/rectangle-2.png"
            alt="Kids' Curved Hilfiger Graphic T-Shirt"
          />
          <div class="frame-15">
            <div class="frame-16">
              <div class="frame-17">
                <div class="kids-curved-hilfiger-wrapper">
                  <h3 class="kids-curved-hilfiger-2">
                    Kids' Curved Hilfiger Graphic T-Shirt
                  </h3>
                </div>
                <div class="text-wrapper-10">Baby pink</div>
                <div class="text-wrapper-10">L</div>
              </div>
              <div class="frame-18">
                <div class="text-wrapper-11">$ 25</div>
              </div>
            </div>
            <div class="frame-12">
              <div class="frame-19" role="group" aria-label="Quantity controls">
                <button
                  type="button"
                  class="quantity-button"
                  aria-label="Decrease quantity"
                >
                  <img class="img-2" src="images/minus.png" alt="" />
                </button>
                <div class="frame-20"><div class="text-wrapper-12">1</div></div>
                <button
                  type="button"
                  class="quantity-button"
                  aria-label="Increase quantity"
                >
                  <img class="img-2" src="images/plus.png" alt="" />
                </button>
              </div>
              <div class="frame-21">
                <button type="button" class="remove-button">
                  <span class="text-wrapper-13">Remove</span>
                </button>
              </div>
            </div>
          </div>
        </article>
        <article class="frame-22" aria-label="Cart item 2">
          <img
            class="rectangle-3"
            src="images/rectangle-3.png"
            alt="Kids' Curved Hilfiger Graphic T-Shirt"
          />
          <div class="frame-15">
            <div class="frame-16">
              <div class="frame-17">
                <div class="kids-curved-hilfiger-wrapper">
                  <h3 class="kids-curved-hilfiger-2">
                    Kids' Curved Hilfiger Graphic T-Shirt
                  </h3>
                </div>
                <div class="text-wrapper-10">Baby pink</div>
                <div class="text-wrapper-10">L</div>
              </div>
              <div class="frame-18">
                <div class="text-wrapper-11">$ 25</div>
              </div>
            </div>
            <div class="frame-12">
              <div class="frame-19" role="group" aria-label="Quantity controls">
                <button
                  type="button"
                  class="quantity-button"
                  aria-label="Decrease quantity"
                >
                  <img class="img-2" src="images/minus.png" alt="" />
                </button>
                <div class="frame-20"><div class="text-wrapper-12">1</div></div>
                <button
                  type="button"
                  class="quantity-button"
                  aria-label="Increase quantity"
                >
                  <img class="img-2" src="images/plus.png" alt="" />
                </button>
              </div>
              <div class="frame-21">
                <button type="button" class="remove-button">
                  <span class="text-wrapper-13">Remove</span>
                </button>
              </div>
            </div>
          </div>
        </article>
        <div class="frame-23" aria-label="Order summary">
          <div class="frame-12">
            <div class="text-wrapper-14">Items subtotal</div>
            <div class="text-wrapper-15">$ 50</div>
          </div>
          <div class="frame-12">
            <div class="text-wrapper-14">Delivery</div>
            <div class="text-wrapper-15">$ 5</div>
          </div>
          <div class="frame-12">
            <div class="text-wrapper-16">Total</div>
            <div class="text-wrapper-16">$55</div>
          </div>
        </div>
      </aside>
      <!--  -->
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");

        if (productId) {
          try {
            const response = await fetch(
              `https://api.redseam.redberryinternship.ge/api/products/${productId}`,
              {
                headers: {
                  Accept: "application/json",
                },
              }
            );
            if (!response.ok) throw new Error("Product not found");
            const product = await response.json();

            console.log(product);

            // Update main image
            const mainImage = document.querySelector(".rectangle");
            if (mainImage) {
              mainImage.src = product.cover_image || "";
              mainImage.alt = `${toCapitalCase(
                product.name
              )} - Main product image`;
            } else {
              console.warn("Main image (.rectangle) not found");
            }

            // Update thumbnail images
            let productImages = "";
            if (product.images) {
              product.images.forEach((img) => {
                productImages += `
              <button
                class="thumbnail-button"
                type="button"
                aria-label="View product image"
              >
                <img
                  class="image"
                  src="${img}"
                  alt="Product thumbnail"
                />
              </button>
              `;
              });
              const thumbnailContainer = document.querySelector(".frame-2");
              if (thumbnailContainer) {
                thumbnailContainer.innerHTML = productImages;
              } else {
                console.warn("Thumbnail container (.frame-2) not found");
              }
            }

            // Update product name and price
            const productName = document.querySelector(".product-name");
            if (productName) {
              productName.innerText = toCapitalCase(product.name);
            } else {
              console.warn("Product name (.product-name) not found");
            }

            const productPrice = document.querySelector(".product-price");
            if (productPrice) {
              productPrice.innerText = `$${product.price}`;
            } else {
              console.warn("Product price (.product-price) not found");
            }

            // Dynamic color picker (replace static fieldset)
            const colorPickerContainer = document.createElement("fieldset");
            colorPickerContainer.className = "frame-6";
            const legend = document.createElement("legend");
            legend.className = "text-wrapper-4";
            legend.textContent = `Color: ${
              product.available_colors ? product.available_colors[0] : "N/A"
            }`;
            const radioGroup = document.createElement("div");
            radioGroup.className = "frame-7";
            radioGroup.setAttribute("role", "radiogroup");
            radioGroup.setAttribute("aria-label", "Color options");

            if (
              product.available_colors &&
              product.available_colors.length > 0
            ) {
              product.available_colors.forEach((color, index) => {
                const inputId = `color-${color
                  .toLowerCase()
                  .replace(/\s/g, "-")}`;
                const input = document.createElement("input");
                input.type = "radio";
                input.id = inputId;
                input.name = "color";
                input.className = "color-input";
                input.value = color.toLowerCase();
                if (index === 0) input.checked = true;

                const label = document.createElement("label");
                label.htmlFor = inputId;
                label.className = "component";
                label.setAttribute("aria-label", `${color} color option`);
                label.style.backgroundColor = getColorValue(color);
                label.style.borderRadius = "50%";

                radioGroup.appendChild(input);
                radioGroup.appendChild(label);
              });

              radioGroup.addEventListener("change", (e) => {
                const selectedInput = e.target;
                if (selectedInput.checked) {
                  const selectedColor = selectedInput.value;
                  legend.textContent = `Color: ${toCapitalCase(selectedColor)}`;
                }
              });
            } else {
              const noColor = document.createElement("p");
              noColor.textContent = "No colors available";
              radioGroup.appendChild(noColor);
            }

            colorPickerContainer.appendChild(legend);
            colorPickerContainer.appendChild(radioGroup);

            // Replace the static color picker inside .frame-5
            const productOptions = document.querySelector(".frame-3");
            if (productOptions) {
              const formContainer = productOptions.querySelector(".frame-5");
              if (formContainer) {
                const staticColorPicker =
                  formContainer.querySelector(".frame-6");
                if (staticColorPicker) {
                  formContainer.replaceChild(
                    colorPickerContainer,
                    staticColorPicker
                  );
                } else {
                  formContainer.insertBefore(
                    colorPickerContainer,
                    formContainer.firstChild
                  ); // Fallback
                }
              } else {
                console.error("Form container (.frame-5) not found");
                productOptions.appendChild(colorPickerContainer); // Fallback
              }
            } else {
              console.error("Product options container (.frame-3) not found");
              document.body.appendChild(colorPickerContainer); // Last resort
            }
          } catch (error) {
            console.error("Error fetching product details:", error);
            const errorContainer =
              document.querySelector(".frame-3") ||
              document.querySelector(".listing-page");
            if (errorContainer) {
              errorContainer.innerHTML =
                "<p>Product not found or error occurred.</p>";
            } else {
              document.body.innerHTML =
                "<p>Product not found or error occurred.</p>";
            }
          }
        } else {
          const noIdContainer =
            document.querySelector(".frame-3") ||
            document.querySelector(".listing-page");
          if (noIdContainer) {
            noIdContainer.innerHTML = "<p>No product ID provided.</p>";
          } else {
            document.body.innerHTML = "<p>No product ID provided.</p>";
          }
        }
      });

      function getColorValue(color) {
        const colorMap = {
          yellow: "#FFFF00",
          green: "#00FF00",
          purple: "#800080",
          pink: "#FFC1CC",
          white: "#FFFFFF",
          red: "#FF0000",
          blue: "#0000FF",
          "navy blue": "#000080",
          black: "#000000",
          beige: "#F5F5DC",
          grey: "#808080",
          orange: "#FFA500",
          multi: "#808080",
        };
        return colorMap[color.toLowerCase()] || "#808080";
      }

      function toCapitalCase(str) {
        return str
          .toLowerCase()
          .split(" ")
          .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
          .join(" ");
      }
    </script>
  </body>
</html>
